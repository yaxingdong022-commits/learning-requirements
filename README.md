# Scrapy 30 å¤©å®æˆ˜è®­ç»ƒ

## å¯¼å¸ˆä¿¡æ¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä½ çš„çˆ¬è™«å¯¼å¸ˆ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  èº«ä»½ï¼šèµ„æ·±ç½‘ç»œçˆ¬è™«å·¥ç¨‹å¸ˆï¼Œ10 å¹´å®æˆ˜ç»éªŒ                      â”‚
â”‚                                                             â”‚
â”‚  æ“…é•¿ï¼š                                                     â”‚
â”‚  â”œâ”€ æ¡†æ¶ï¼šScrapyã€Playwrightã€Seleniumã€PySpider            â”‚
â”‚  â”œâ”€ è¯·æ±‚ï¼šRequestsã€HTTPXã€aiohttpã€curl_cffi               â”‚
â”‚  â”œâ”€ è§£æï¼šCSSã€XPathã€æ­£åˆ™ã€BeautifulSoupã€Parsel           â”‚
â”‚  â”œâ”€ åçˆ¬ï¼šJS é€†å‘ã€éªŒè¯ç ã€æŒ‡çº¹ã€Cookieã€ä»£ç†æ±               â”‚
â”‚  â”œâ”€ å­˜å‚¨ï¼šMySQLã€MongoDBã€Redisã€Elasticsearch              â”‚
â”‚  â”œâ”€ åˆ†å¸ƒå¼ï¼šScrapy-Redisã€Celeryã€æ¶ˆæ¯é˜Ÿåˆ—                  â”‚
â”‚  â””â”€ éƒ¨ç½²ï¼šDockerã€Scrapydã€K8sã€å®šæ—¶è°ƒåº¦                    â”‚
â”‚                                                             â”‚
â”‚  æ•™å­¦é£æ ¼ï¼š                                                  â”‚
â”‚  â”œâ”€ å®æˆ˜æ´¾ï¼Œä»£ç å…ˆè¡Œ                                        â”‚
â”‚  â”œâ”€ ä¸è®²åºŸè¯ï¼Œç›´å‡»é‡ç‚¹                                      â”‚
â”‚  â”œâ”€ æœ‰é—®å¿…ç­”ï¼Œä½†ä½ å¾—å…ˆåŠ¨æ‰‹è¯•                                â”‚
â”‚  â””â”€ ä¸¥æ ¼è¦æ±‚ï¼ŒéªŒæ”¶ä¸è¿‡å°±é‡åš                                â”‚
â”‚                                                             â”‚
â”‚  å£å¤´ç¦…ï¼š                                                   â”‚
â”‚  "æŠ¥é”™ä¿¡æ¯æ˜¯æœ€å¥½çš„è€å¸ˆ"                                     â”‚
â”‚  "åˆ«çŒœï¼Œç”¨ shell è°ƒè¯•"                                      â”‚
â”‚  "è·‘é€šäº†å†è¯´åŸç†"                                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å­¦ä¹ è¿›åº¦

| å¤©æ•° | ä¸»é¢˜ | çŠ¶æ€ |
|-----|------|------|
| Day 1 | åŸºç¡€çˆ¬è™«ï¼šé€‰æ‹©å™¨ã€æå–æ•°æ® | âœ… å·²å®Œæˆ |
| Day 2 | è‡ªåŠ¨ç¿»é¡µ | âœ… å·²å®Œæˆ |
| Day 3 | è·Ÿè¸ªè¯¦æƒ…é¡µ | ğŸ”„ è¿›è¡Œä¸­ |
| Day 4 | Items + Pipelines | â¬œ |
| Day 5 | Settings + åçˆ¬ | â¬œ |
| Day 6 | Ajax æ¥å£ | â¬œ |
| Day 7 | Playwright åŠ¨æ€æ¸²æŸ“ | â¬œ |
| ...   | ...  | ... |

---

## CSS é€‰æ‹©å™¨é€ŸæŸ¥è¡¨

### åŸºç¡€é€‰æ‹©å™¨

| é€‰æ‹©å™¨ | å«ä¹‰ | ç¤ºä¾‹ |
|-------|------|------|
| `div` | æ ‡ç­¾å | æ‰€æœ‰ div |
| `.quote` | class å | class="quote" |
| `#main` | id å | id="main" |
| `div.quote` | æ ‡ç­¾ + class | class="quote" çš„ div |

### å±‚çº§é€‰æ‹©å™¨

| é€‰æ‹©å™¨ | å«ä¹‰ | ç¤ºä¾‹ |
|-------|------|------|
| `div a` | åä»£ï¼ˆä»»æ„å±‚çº§ï¼‰ | div ä¸‹é¢æ‰€æœ‰ a |
| `div > a` | ç›´æ¥å­å…ƒç´ ï¼ˆä¸€å±‚ï¼‰ | div çš„ç›´æ¥å­ a |
| `span.text a` | å¤šå±‚åµŒå¥— | span.text é‡Œçš„ a |

### æå–å†…å®¹

| é€‰æ‹©å™¨ | å«ä¹‰ | ç¤ºä¾‹ |
|-------|------|------|
| `::text` | æå–æ–‡æœ¬ | `span::text` |
| `::attr(href)` | æå–å±æ€§ | `a::attr(href)` |
| `::attr(src)` | æå– src | `img::attr(src)` |

### å±æ€§é€‰æ‹©å™¨

| é€‰æ‹©å™¨ | å«ä¹‰ | ç¤ºä¾‹ |
|-------|------|------|
| `a[href]` | æœ‰ href å±æ€§ | æœ‰é“¾æ¥çš„ a |
| `a[href="/page"]` | href ç­‰äº | ç²¾ç¡®åŒ¹é… |
| `a[href*="/author/"]` | href åŒ…å« | æ¨¡ç³ŠåŒ¹é… |
| `a[href^="/page"]` | href å¼€å¤´ | ä»¥ /page å¼€å¤´ |
| `a[href$=".jpg"]` | href ç»“å°¾ | ä»¥ .jpg ç»“å°¾ |

### è·å–æ–¹æ³•

| æ–¹æ³• | è¿”å› | ç¤ºä¾‹ |
|-----|------|------|
| `.get()` | ç¬¬ä¸€ä¸ªï¼ˆå­—ç¬¦ä¸²ï¼‰ | "hello" |
| `.getall()` | æ‰€æœ‰ï¼ˆåˆ—è¡¨ï¼‰ | ["a", "b", "c"] |

---

## å¸¸ç”¨å‘½ä»¤

```bash
# åˆ›å»ºé¡¹ç›®
scrapy startproject é¡¹ç›®å

# åˆ›å»ºçˆ¬è™«
scrapy genspider çˆ¬è™«å åŸŸå

# è¿è¡Œçˆ¬è™«
scrapy crawl çˆ¬è™«å -o æ–‡ä»¶å.json

# è°ƒè¯•é€‰æ‹©å™¨
scrapy shell "ç½‘å€"
```

---

## æ ¸å¿ƒä»£ç æ¨¡æ¿

### Day 1ï¼šåŸºç¡€çˆ¬è™«

```python
import scrapy

class QuotesSpider(scrapy.Spider):
    name = "quotes"
    start_urls = ["https://quotes.toscrape.com/"]

    def parse(self, response):
        for quote in response.css("div.quote"):
            yield {
                "text": quote.css("span.text::text").get(),
                "author": quote.css("small.author::text").get(),
            }
```

### Day 2ï¼šè‡ªåŠ¨ç¿»é¡µ

```python
def parse(self, response):
    # æå–æ•°æ®
    for quote in response.css("div.quote"):
        yield {"text": quote.css("span.text::text").get()}  
    
    # ç¿»é¡µ
    next_page = response.css("li.next a::attr(href)").get()
    if next_page:
        yield response.follow(next_page, callback=self.parse)
```

### Day 3ï¼šè·Ÿè¸ªè¯¦æƒ…é¡µ

```python
def parse(self, response):
    for quote in response.css("div.quote"):
        author_url = quote.css('a[href*="/author/"]::attr(href)').get()
        if author_url:
            yield response.follow(
                author_url,
                callback=self.parse_author,
                cb_kwargs={"text": quote.css("span.text::text").get()}
            )


def parse_author(self, response, text):
    yield {
        "text": text,
        "author_born": response.css(".author-born-date::text").get(),
    }
```

---

## å¸¸è§é”™è¯¯

| é”™è¯¯ | åŸå›  | è§£å†³ |
|-----|------|------|
| `url can't be None` | é€‰æ‹©å™¨æ²¡æ‰¾åˆ°é“¾æ¥ | ç”¨ shell è°ƒè¯•é€‰æ‹©å™¨ |
| `NoneType has no attribute 'strip'` | `.get()` è¿”å› None | åŠ åˆ¤æ–­æˆ–ç”¨ `or ""` |
| JSON ä¸ºç©º | ä»£ç æ²¡å†™å®Œæ•´ / é€‰æ‹©å™¨é”™ | æ£€æŸ¥ä»£ç å’Œé€‰æ‹©å™¨ |
| åªçˆ¬äº†ä¸€é¡µ | ç¿»é¡µé€»è¾‘æ²¡å†™ | åŠ  `yield response.follow` |

---

## å­¦ä¹ è§„çŸ©

1. æ¯å¤©ä¸€ä¸ªå®æˆ˜ä»»åŠ¡
2. å®Œæˆåæˆªå›¾éªŒæ”¶
3. é‡åˆ°é—®é¢˜å…ˆçœ‹æŠ¥é”™ï¼Œæä¸å®šå†é—®
4. ä»£ç äº²æ‰‹æ•²ï¼Œåˆ«å…‰çœ‹
